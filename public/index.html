<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" type="text/javascript"></script>
    <title>App A</title>
    <style>
        #rectangleArea {
            background: yellow;
            width: 500px;
            height: 500px;
        }
        
        #blue {
            background: blue;
            width: 160px;
            height: 160px;
            position: relative;
        }
        
        #red {
            background: red;
            width: 70px;
            height: 70px;
            position: absolute;
            left: 45px;
            top: 45px;
        }
        
        #text {
            display: block;
            height: 100px;
            width: 400px;
        }
        
        .dot {
            width: 2px;
            height: 2px;
            background-color: black;
            position: absolute;
        }
    </style>
</head>

<body>
    <div id="rectangleArea" onmouseenter="cursorEntry(event)" onmousemove="handleMouseMove(event)" onmouseleave="cursorLeave(event)">

    </div>

    <textarea id="text"></textarea>
    <input type="button" onclick="text.value=''" value="Clear">

    <script>
        // document.onmousemove = handleMouseMove;  
        var socket;
        socket = io.connect('http://localhost:3000/')



        var handleNextKeypress = true;
        var X = 0.1;

        function setHandleNextKeypressTrue() {
            handleNextKeypress = true;
        }

        function setHandleNextKeypressTrueAfterDelay(delay) {
            setTimeout(setHandleNextKeypressTrue, delay);
        }

        // $("#inputField").on("keypress", function(event) {
        //     if (handleNextKeypress) {
        //         $("div#output").append("key pressed <br/>");
        //         handleNextKeypress = false;
        //         setHandleNextKeypressTrueAfterDelay(X * 1000);
        //     }
        // });

        // $("#clear").on("click", function(event) {
        //     $("div#output").html("");
        // });



        function cursorEntry(event) {
            console.log("in the div");
            console.log(event.x, event.y)
        }

        function cursorLeave(event) {
            console.log("out of the div");
            console.log(event.x, event.y)
        }

        function log(event) {
            text.value += event.type + ' [target: ' + event.target.id + ']' + " " + event.pageX + " " + event.pageY + '\n';
            text.scrollTop = text.scrollHeight;
        }

        function handleMouseMove(event) {

            // var dot, eventDoc, doc, body, pageX, pageY;

            // event = event || window.event; // IE-ism


            // If pageX/Y aren't available and clientX/Y
            // are, calculate pageX/Y - logic taken from jQuery
            // Calculate pageX/Y if missing and clientX/Y available
            // if (event.pageX == null && event.clientX != null) {
            //     eventDoc = (event.target && event.target.ownerDocument) || document;
            //     doc = eventDoc.documentElement;
            //     body = eventDoc.body;

            //     event.pageX = event.clientX +
            //         (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
            //         (doc && doc.clientLeft || body && body.clientLeft || 0);
            //     event.pageY = event.clientY +
            //         (doc && doc.scrollTop || body && body.scrollTop || 0) -
            //         (doc && doc.clientTop || body && body.clientTop || 0);
            // }
            // console.log(event, event.pageX, event.pageY, event.clientX, event.clientY)
            // var data = {
            //     x: event.pageX,
            //     y: event.pageY
            // }
            var data;
            var date = new Date();
            if (handleNextKeypress) {
                console.log('mouse moved')
                console.log(event, event.pageX, event.pageY, event.clientX, event.clientY)
                data = {
                    x: event.pageX,
                    y: event.pageY,
                    time: Date.now()
                }
                socket.emit('mouse', data)
                log(event)
                    // Add a dot to follow the cursor
                dot = document.createElement('div');
                dot.className = "dot";
                dot.style.left = data.x + "px";
                dot.style.top = data.y + "px";

                document.getElementById("rectangleArea").appendChild(dot);


                handleNextKeypress = false;
                setHandleNextKeypressTrueAfterDelay(X * 1000);
            }
            // setTimeout(function() {

            //     socket.emit('mouse', data)
            //     log(event)
            //         // Add a dot to follow the cursor
            //     dot = document.createElement('div');
            //     dot.className = "dot";
            //     dot.style.left = data.x + "px";
            //     dot.style.top = data.y + "px";

            //     document.getElementById("rectangleArea").appendChild(dot);

            //     // socket.emit('clientEvent', Math.random());
            //     // handleMouseMove(event)
            //     // console.log('message sent to the clients');
            // }, 2000);
            // socket.emit('mouse', data)
            // log(event)
            //     // Add a dot to follow the cursor
            // dot = document.createElement('div');
            // dot.className = "dot";
            // dot.style.left = event.pageX + "px";
            // dot.style.top = event.pageY + "px";

            // document.getElementById("rectangleArea").appendChild(dot);

        }
    </script>
</body>

</html>